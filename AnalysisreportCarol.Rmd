---
title: "Group2 Report"
author: "Carol Kamya"
date: "9/19/2022"
output: html_document
---

```{r setup, include=FALSE}
```


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```

## R Markdown

This report is generated by Carol Kamya. It is based on the tasks assigned to generate the group work project.

```{r echo=FALSE}
library(tidyverse)
library(here)
library(ggcorrplot)
library(patchwork)
library(ggplot2)

data<-read_delim (here("groupproject", "exam_nontidy.txt"))

#exploring the missing values
#naniar::gg_miss_var(data)
#colSums(is.na(data))

#removing duplicates
data<-
  data %>% 
  distinct()

#removing unnecessary columns (according to the exam description)
data<-
  data %>% 
  select(-AA, -bGS, -`BN+`,-OrganConfined)

#renaming some columns that had long names, space in between characters, or started with a number
data<-
  data %>% 
  rename(volmx=`volume measurement`, 
         value=.value,
         age=`1_Age`,
         t_stage=`T stage`)

#Create new hospital variable that breaks up 'subject' into two variables Hospitalname and id.
data<-
  data %>% 
  separate(col = subject, 
           into = c("Hospitalname", "id"), 
           sep = "-")


#creating two columns for PVol and TVol
data<- 
  data %>% 
  pivot_wider(names_from = volmx,
              values_from =value)


#creating a column that shows PVol values as high and low
data<-
  data %>% 
  mutate(pvol_binary=if_else(PVol>100, "High", "Low"))

#creating a column which shows the time to recurrence as days
data<-
  data %>% 
  mutate(TimeToRecurrence_days=if_else(TimeToRecurrence_unit=="week", (TimeToRecurrence*7), TimeToRecurrence))

#then, removing the old time to recurrence columns as now they are unnecessary
data<- 
  data %>% 
  select(-TimeToRecurrence, -TimeToRecurrence_unit)


#A column showing Recurrence as Yes/No
data<-
  data %>% 
  mutate(Recurrence=if_else(Recurrence==0, "NO", "Yes"))

#A numeric column showing multiplication of AnyAdjTherapy and PreopTherapy for each person

data<- 
  data %>% 
  mutate(PreopAdjTherapy=AnyAdjTherapy*PreopTherapy) 


#ordering columns 

data<-
  data %>% 
  select(id, Hospitalname, age, everything())

#arranging the IDs in increasing order
data<-
  data %>% 
  arrange(id)


#change id in orginal data to 'double'(id in the original data and the merge data need to be the same type)

data<-  
  data %>%
  mutate(id = as.numeric(id))

#Reading the second dataset and calling it data2
data2<-
  read_delim(here("groupproject", "exam_joindata.txt"))


#Join new data to original data

data<- 
  data %>%
  full_join(data2, by = "id")
view(data)
#piping all the changes above


```

##Plots


###Plot 1 Does the distribution of PVol depend on sGS? 
#### It seems that the distribution of PVol depends on the level SGS.Those in category 2 have the highest PVol mean. 
```{r, echo=FALSE}
#Does the distribution of PVol depend on sGS?*

#It seems that the distribution of PVol depends on the level SGS.Those in category 2 have the highest PVol mean*
  
data %>% 
  filter(!is.na(sGS)) %>% 
  ggplot(data, mapping = aes(x=as.factor(sGS), y=PVol))+
  geom_boxplot(mapping = NULL, stat = "boxplot", position ="dodge2")
```

###Plot 2:Did having AdjRadTherapy affected time to recurrence?
#### This relationship is unclear because there are very few 1's in the anyadjtherapy recurrence. The mean is higher in those with 0's. From the ANNOVA test, the p value is 0.592. 
```{r , echo=FALSE}

#Did having AdjRadTherapy affected time to recurrence?
#Boxplot showing AdjRadtheory vs recurrence
#Results: This relationship is unclear because the there are very few 1's in the anyadjtherapy recurrence.
#However the mean is higher in those with 0's
#The p value value is 0.592. 

Anyadjtherapy_recurrence <-data %>%
  filter(!is.na(TimeToRecurrence_days)) %>%
  ggplot(data, mapping = aes(x=as.factor(AdjRadTherapy), y=TimeToRecurrence_days))+
  geom_boxplot(mapping = NULL, stat = "boxplot", position ="dodge2")

Anyadjtherapy_recurrence 

data %>% 
  mutate(TimeToRecurrence_days = log(TimeToRecurrence_days)) %>%
  aov(TimeToRecurrence_days~AdjRadTherapy, data = .) %>% 
  broom::tidy()
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
